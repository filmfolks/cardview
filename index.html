<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>OVOR Dictionary/title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gradient-to-b from-blue-100 to-white min-h-screen flex flex-col items-center p-4">

  <h1 class="text-3xl font-bold text-blue-600 mt-6 mb-4">üìñ Simple Dictionary</h1>

  <!-- Search -->
  <div class="w-full max-w-md flex gap-2">
    <input id="wordInput"
           class="flex-1 p-3 border rounded-2xl shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-400"
           placeholder="Enter a word..." onkeydown="if(event.key==='Enter') fetchMeaning()" />
    <button id="searchBtn" onclick="fetchMeaning()"
            class="px-4 py-2 bg-blue-500 text-white rounded-2xl shadow-md hover:bg-blue-600">
      Search
    </button>
  </div>

  <!-- Translate controls -->
  <div class="w-full max-w-md mt-4 flex gap-2 items-center">
    <select id="langSelect" class="flex-1 p-2 border rounded-xl">
      <optgroup label="Indian languages">
        <option value="hi" selected>Hindi</option>
        <option value="bn">Bengali</option>
        <option value="gu">Gujarati</option>
        <option value="kn">Kannada</option>
        <option value="ml">Malayalam</option>
        <option value="mr">Marathi</option>
        <option value="or">Odia</option>
        <option value="pa">Punjabi</option>
        <option value="ta">Tamil</option>
        <option value="te">Telugu</option>
        <option value="ur">Urdu</option>
        <option value="ne">Nepali</option>
        <option value="sa">Sanskrit</option>
      </optgroup>
      <optgroup label="Other common">
        <option value="en">English</option>
        <option value="fr">French</option>
        <option value="de">German</option>
        <option value="es">Spanish</option>
      </optgroup>
    </select>
    <button onclick="translateAll()"
            class="px-4 py-2 bg-green-600 text-white rounded-2xl shadow-md hover:bg-green-700">
      Translate
    </button>
  </div>

  <!-- Messages -->
  <p id="loading" class="mt-6 text-gray-600 hidden">Loading...</p>
  <p id="error" class="mt-3 text-red-500 hidden"></p>

  <!-- Results: side by side -->
  <div id="resultContainer" class="mt-6 w-full max-w-4xl grid grid-cols-1 md:grid-cols-2 gap-4">
    <div id="resultEnglish" class="bg-white shadow-lg rounded-2xl p-4 hidden"></div>
    <div id="resultTranslated" class="bg-white shadow-lg rounded-2xl p-4 hidden"></div>
  </div>

  <script>
    let groupedDefinitions = {};
    let lastWord = "";

    function setLoading(isLoading) {
      document.getElementById("loading").classList.toggle("hidden", !isLoading);
      document.getElementById("searchBtn").disabled = isLoading;
    }

    function showError(msg) {
      const e = document.getElementById("error");
      e.textContent = "‚ùå " + msg;
      e.classList.remove("hidden");
    }

    function clearError() {
      const e = document.getElementById("error");
      e.textContent = "";
      e.classList.add("hidden");
    }

    async function fetchMeaning() {
      const word = document.getElementById("wordInput").value.trim();
      const englishDiv = document.getElementById("resultEnglish");
      const translatedDiv = document.getElementById("resultTranslated");

      if (!word) return;
      setLoading(true); clearError();
      englishDiv.innerHTML = ""; translatedDiv.innerHTML = "";
      englishDiv.classList.add("hidden"); translatedDiv.classList.add("hidden");
      groupedDefinitions = {}; lastWord = word;

      try {
        const response = await fetch(`https://api.dictionaryapi.dev/api/v2/entries/en/${encodeURIComponent(word)}`);
        if (!response.ok) throw new Error("Word not found in dictionary");
        const data = await response.json();
        const entry = data[0];

        let html = `<h2 class="text-2xl font-semibold text-gray-800">${entry.word}</h2>`;
        html += `<p class="italic text-gray-500">${entry.phonetic || ""}</p>`;

        entry.meanings.forEach((meaning) => {
          if (!groupedDefinitions[meaning.partOfSpeech]) {
            groupedDefinitions[meaning.partOfSpeech] = [];
          }
          const defs = meaning.definitions.map(d => d.definition);
          groupedDefinitions[meaning.partOfSpeech].push(...defs);

          html += `<div class="mt-4"><p class="font-semibold text-blue-600">${meaning.partOfSpeech}</p>
            <ul class="list-disc list-inside text-gray-700">
            ${defs.map(def => `<li class="mt-1">${def}</li>`).join("")}
            </ul></div>`;
        });

        englishDiv.innerHTML = html;
        englishDiv.classList.remove("hidden");
      } catch (err) {
        showError(err.message);
      } finally {
        setLoading(false);
      }
    }

    function decodeEntities(str) {
      const ta = document.createElement("textarea");
      ta.innerHTML = str;
      return ta.value;
    }

    async function translateOne(text, target) {
      const url = `https://api.mymemory.translated.net/get?q=${encodeURIComponent(text)}&langpair=en|${encodeURIComponent(target)}`;
      const res = await fetch(url);
      if (!res.ok) throw new Error("Translation service error");
      const data = await res.json();
      return decodeEntities(data?.responseData?.translatedText || "");
    }

    async function translateAll() {
      const translatedDiv = document.getElementById("resultTranslated");
      const target = document.getElementById("langSelect").value;

      if (!lastWord || Object.keys(groupedDefinitions).length === 0) {
        translatedDiv.innerHTML = "<p class='text-red-600'>‚ö†Ô∏è Search a word first.</p>";
        translatedDiv.classList.remove("hidden");
        return;
      }

      translatedDiv.innerHTML = `<div class="text-gray-700">üîÑ Translating...</div>`;
      translatedDiv.classList.remove("hidden");
      setLoading(true); clearError();

      try {
        let outHtml = `<h2 class="text-2xl font-semibold text-gray-800">${lastWord}</h2>`;
        outHtml += `<p class="italic text-gray-500">üåç ${document.querySelector('#langSelect option:checked').textContent}</p>`;

        for (const [pos, defs] of Object.entries(groupedDefinitions)) {
          outHtml += `<div class="mt-4"><p class="font-semibold text-green-600">${pos}</p><ul class="list-disc list-inside text-gray-800">`;

          for (const def of defs) {
            let translated = "";
            try {
              translated = await translateOne(def, target);
            } catch {
              translated = "[translation unavailable]";
            }
            outHtml += `<li class="mt-1">${translated}</li>`;
          }

          outHtml += "</ul></div>";
        }

        translatedDiv.innerHTML = outHtml;
      } catch (err) {
        showError(err.message);
      } finally {
        setLoading(false);
      }
    }
  </script>
</body>
</html>
